<div i18n:domain="ntpu.content">
<br><br>

<tal:checkEdit condition="python:'@@edit' not in context.REQUEST['URL'] and
                                  '@@retractArticle' not in context.REQUEST['URL']">
<tal:review condition="python:'Super Editor' in view.getView.getRoles() and
                              view.getView.getReviewState() == 'inReview'" >
  <a href="./edit" i18n:translate="">Review</a>
</tal:review>

<!-- 責編 -->
<tal:review condition="python:'Internal Reviewer' in view.getView.getRoles() and
                              view.getView.getReviewState() in ['internalAssigned', 'retrial']" >
  <a href="./edit" i18n:translate="">Review</a>
</tal:review>

<!-- 委員 -->
<tal:review condition="python:'External Reviewer' in view.getView.getRoles() and
                              view.getView.getReviewState() in ['internalAssigned', 'retrial'] and
                              not bool(view.getView.checkReviewConfirm())">
  <a href="./edit" i18n:translate="">Review</a>
</tal:review>

<tal:review condition="python:'External Reviewer' in view.getView.getRoles() and
                              view.getView.getReviewState() in ['internalAssigned', 'retrial'] and
                              not bool(view.getView.checkReviewConfirm())" >
  <a tal:attributes="href string:${context/absolute_url}/@@reviewConfirm" i18n:translate="">Review Confirm</a>
</tal:review>

<tal:edit condition="python:'Site Administrator' in view.getView.getRoles()" >
<tal:check condition="python:view.getView.getSelfBrain().review_state in ['submitted']">
||  <a href="./edit">型式審</a>
||  <a href="./content_status_modify?workflow_action=toInReview">送至主編</a>
</tal:check>
<tal:check condition="python:view.getView.getSelfBrain().review_state in ['reSubmitted']">
||  <a href="./edit">型式審</a>
||  <a href="./content_status_modify?workflow_action=toRetrial">重送審查委員審查</a>
</tal:check>
<!-- 用form的型式配合event處理退稿 -->
||  <a href="./@@retractArticle">退稿</a>
<!--  <a href="./content_status_modify?workflow_action=retract">退稿</a> -->

</tal:edit>

<tal:edit condition="python:view.getView.isOwner() and view.getView.getSelfBrain().review_state in ['draft', 'modifyThenReview']" >
||  <a href="./edit" i18n:translate="">Edit</a>
<tal:check condition="python:context.allAuthorConsent and context.license and view.getView.getSelfBrain().review_state == 'draft'">
||  <a href="./content_status_modify?workflow_action=submitting">提交稿件</a>
</tal:check>
<tal:check condition="python:context.allAuthorConsent and context.license and view.getView.getSelfBrain().review_state == 'modifyThenReview'">
||  <a href="./content_status_modify?workflow_action=toReSubmitted">重新提交</a>
</tal:check>
</tal:edit>

<tal:assignInternal condition="python:bool(context.assignInternalReviewer) and
                                      'Internal Reviewer' in view.getView.getRoles() and
                                      view.getView.getCurrent().getId() == context.assignInternalReviewer.to_object.owner_info()['id']">
||  <a tal:attributes="href string:${context/absolute_url}/content_status_modify?workflow_action=assignInternal">
  確認提交
  </a>
</tal:assignInternal>





<tal:review_result condition="python:bool(context.reviewFeedback) and
                                     view.getView.getReviewState() in ['internalAssigned', 'retrial'] and
                                     'Internal Reviewer' in view.getView.getRoles()">
<hr>
<h5>確認審查結果</h5>
<tal:assignInternal>
  <a tal:attributes="href string:${context/absolute_url}/content_status_modify?workflow_action=MR">
    修改後審查
  </a>
||  <a tal:attributes="href string:${context/absolute_url}/content_status_modify?workflow_action=accept">
    建議推薦
  </a>
||  <a tal:attributes="href string:${context/absolute_url}/content_status_modify?workflow_action=reject">
    不予推薦
  </a>


</tal:assignInternal>
</tal:review_result>




</tal:checkEdit>

</div>
